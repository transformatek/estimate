var userTablecontainer="blankContent";var INPUT_NAME_PREFIX="inputName";var RADIO_NAME="radName";var TABLE_NAME="userSample";var DIV_NAV_NAME="userNavDiv";var ROW_BASE=1;var hasLoaded=false;var ctx_THEAD="USR_TTHEAD123";var ctx_TBODY="USR_TTBODY123";var callBack=function(){if(myContextMenuRequest.readyState==4){if(myContextMenuRequest.status==200){configureContextMenu();callUserAjax()}else{alert("Connection Problem:"+myContextMenuRequest.statusText)}}};var initializeUserManagementTable=function(a){myCurrentMenuParent=a;writeWaitMsg(userTablecontainer,"themes/icons/ajax_loading/22.gif","Loading Menu...");callContextMenuAjax(a,callBack)};var menu2=function(){return configureContextMenuModel()};contextMenu.modifyMenu=function(){var a=this.srcElement;currentMenuBar=this.menuBar;var b;while(true){b=a.parentNode;if(b.tagName!="TR"){a=b;continue}else{break}}clickOnTableRowContext(b);if(b.myRow==null){setMenuItemState(211920,"disabled");setMenuItemState(211940,"disabled")}else{setMenuItemState(211920,"regular");setMenuItemState(211940,"regular")}setMenuPermissions(currentMenuBar)};function callUserAjax(){if(document.getElementById(userTablecontainer)==null){return}var b=getHTMLHTTPRequest();var c=parseInt(Math.random()*99999999);var a=myServerAddress+"MyXMLDispatcher?rand="+c+"&path="+20910+"&method=getUsers";b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200){renderUser(b)}else{alert("Connection Problem:"+b.statusText)}}};writeWaitMsg(userTablecontainer,"themes/icons/ajax_loading/22.gif","Processing request, please wait...");b.send(null)}function renderUser(b){var c=b.responseXML;if(c==null){alert("Data Error");return}var d=c.getElementsByTagName("status");var a=systemStatus(userTablecontainer,d);if(a==0){return}var e="";e+="<div id='"+DIV_NAV_NAME+"'></div>";e+="<table id='"+TABLE_NAME+"' width='100%' class='contentTable'><thead id='"+ctx_THEAD+"'><tr><td width='18px'>&nbsp;</td><td width='1%'>Sl</td><td width='10%'>userID</td><td width='15%'>Full Name</td><td width='15%'>Employee Code</td><td width='100%'>Remarks</td><td>D</td><td>E</td></tr></thead>";e+="<tbody id='"+ctx_TBODY+"'></tbody></table>";document.getElementById(userTablecontainer).innerHTML=e;updateUserNav(c,DIV_NAV_NAME);populateTable(c,TABLE_NAME);initiateTableRollover(TABLE_NAME,"tableRollOverEffect1","tableRowClickEffect1");contextMenu.attachTo(ctx_THEAD,menu2());contextMenu.attachTo(ctx_TBODY,menu2())}var updateUserNav=function(b,a){var c="<table class='navTable'><tr>";c+="<td><a style='text-decoration: none;' href='javascript:void(0);' onclick='myUserAddWindow(\""+TABLE_NAME+"\");'>Add User</a></td>";c+="<td><a style='text-decoration: none;' href='javascript:void(0);' onclick='deleteChecked(\""+TABLE_NAME+"\");'>Delete[D]</a></td>";c+="<td><a style='text-decoration: none;' href='javascript:void(0);' onclick='myUserAccesRightsWindow(\""+TABLE_NAME+"\");'>Access&nbsp;Rights[E]</a></td>";c+="<td>Filter: <input name='filter' onKeyUp='filter(this, \""+TABLE_NAME+"\")' type='text'></td>";c+="</tr></table>";document.getElementById(a).innerHTML=c};var populateTable=function(e,b){var d=e.getElementsByTagName("user");var a;var f;var g;for(var c=0;c<d.length;c++){f=document.getElementById(b);a=f.tBodies[0].rows.length;g=Array();g[0]=d[c].childNodes[0].firstChild.data;g[1]=d[c].childNodes[1].firstChild.data;g[2]=d[c].childNodes[2].firstChild.data;g[3]=d[c].childNodes[3].firstChild.data;g[4]=d[c].childNodes[4].firstChild.data;addRowToTable1(f,-1,g)}};var myRowObject=function(b){this.content=Array();for(var a=0;a<b.length;a++){this.content[a]=b[a]}};var addRowToTable1=function(g,k,j){var m=g.tBodies[0].rows.length;var b=m+ROW_BASE;if(k==-1){k=m}else{b=k+ROW_BASE}var i=g.tBodies[0].insertRow(k);var d=Array();d[0]=i.insertCell(0);d[0].innerHTML="<img src='images/admin/user.png' border='0'>";d[1]=i.insertCell(1);var c=document.createTextNode(b);d[1].appendChild(c);d[2]=i.insertCell(2);var r=document.createTextNode(j[1]);d[2].appendChild(r);d[3]=i.insertCell(3);var q=document.createTextNode(j[2]);d[3].appendChild(q);d[4]=i.insertCell(4);var e=document.createTextNode(j[4]);d[4].appendChild(e);d[5]=i.insertCell(5);var f=document.createTextNode(j[3]);d[5].appendChild(f);d[6]=i.insertCell(6);var p=document.createElement("input");p.setAttribute("type","checkbox");d[6].appendChild(p);d[7]=i.insertCell(7);var l;try{l=document.createElement('<input type="radio" name="'+RADIO_NAME+'" value="'+b+'">');var n=l.name.length}catch(o){l=document.createElement("input");l.setAttribute("type","radio");l.setAttribute("name",RADIO_NAME);l.setAttribute("value",b)}d[7].appendChild(l);var h=Array();h[0]=p;h[1]=l;h[2]=d[0].innerHTML;h[3]=c;h[4]=r;h[5]=q;h[6]=e;h[7]=f;h[8]=j[0];var a=new myRowObject(h);i.myRow=a;addRowRolloverEffect(i)};function callDeleteUserAjax(g,h,d){if(!confirmDelete()){return}var k;var c=Array();var e;var l=getHTMLHTTPRequest();k=g;c=h;e=d;var j=parseInt(Math.random()*99999999);var b="";for(var f=0;f<h.length;f++){if(b==""){b+=h[f].myRow.content[8]}else{b+=","+h[f].myRow.content[8]}}var a=myServerAddress+"MyXMLDispatcher?rand="+j+"&path="+20920+"&userIds="+b+"&method=deleteUsers";l.open("GET",a,true);l.onreadystatechange=function(){if(l.readyState==4){if(l.status==200){var m=l.responseXML;var i=0;if(m==null){alert("Data Error")}else{var n=m.getElementsByTagName("status");i=systemStatus(null,n)}if(i==1){deleteRows(c);reorderRows(k,e)}else{if(i==2){alert("DELETE: System Error")}}}else{alert("Connection Problem:"+l.statusText)}closeSplashScreen()}};openSplashScreen();l.send(null)}var deleteChecked=function(d){var f=document.getElementById(d);var a=new Array();var b=0;for(var c=0;c<f.tBodies[0].rows.length;c++){if(f.tBodies[0].rows[c].myRow.content[0].checked){a[b]=f.tBodies[0].rows[c];b++}}if(a.length>0){var e=a[0].sectionRowIndex;callDeleteUserAjax(f,a,e)}};var deleteRows=function(c){for(var a=0;a<c.length;a++){var b=c[a].sectionRowIndex;c[a].parentNode.deleteRow(b)}};var reorderRows=function(d,c){if(d.tBodies[0].rows[c]){var b=c+ROW_BASE;for(var a=c;a<d.tBodies[0].rows.length;a++){d.tBodies[0].rows[a].myRow.content[3].data=b;b++}}};var deleteContextChecked=function(){var a=new Array();var b=contextMenu.srcElement;while(true){a[0]=b.parentNode;if(a[0].tagName!="TR"){b=a[0];continue}else{break}}var d=a[0].parentNode.parentNode;var c=a[0].sectionRowIndex;callDeleteUserAjax(d,a,c)};var userPropertiesWindowDiv="blankHidden";var userPropertiesWindow=null;var userPropertiesWindowTitle="Properties";var userPropertiesWindowId="userPropertiesWindowId";var indexOfRowToEdit=-1;var rowToEdit=null;var myUserTable=null;var myUserAddWindow=function(a){var b=document.getElementById(a);myUserTable=b;populateUserAddWin()};var populateUserAddWin=function(){var a="<table>";a+="<tr><td><label>userID:</label></td><td><input size='40' type='text' id='editUserID' value='id'></td></tr>";a+="<tr><td><label>Name:</label></td><td><input size='40' type='text' id='editName' value='name'></td></tr>";a+="<tr><td><label>Employee Code:</label></td><td><input size='40' type='text' id='editEmployeeCode' value='-'></td></tr>";a+="<tr><td><label>Remarks:</label></td><td><textarea rows='6' cols='30' id='editRemarks'>remarks</textarea></td></tr>";a+="<tr><td colspan='2' align='center'><a href='javascript:void(0)' onclick='callAddUserAjax();'>Add</a>&nbsp;&nbsp;";a+="<a href='javascript:void(0)' onclick='userPropertiesWindow.close()'>Discard</a></td></tr>";a+="</table>";var b=document.getElementById(userPropertiesWindowDiv);b.innerHTML=a;openMyUserPropertiesWin()};var openMyUserPropertiesWin=function(){userPropertiesWindow=internalWindow.open(userPropertiesWindowId,"div",userPropertiesWindowDiv,"#Properties Window","width=450px,height=300px,left=200px,top=150px,resize=1,scrolling=1")};var myUserAddData="";var myUserAddRequest=getHTMLHTTPRequest();var callAddUserAjax=function(){var b=parseInt(Math.random()*99999999);method="addNewUser";myUserAddData="userId="+URLEncode(document.getElementById("editUserID").value);myUserAddData+="&name="+URLEncode(document.getElementById("editName").value);myUserAddData+="&employeeCode="+URLEncode(document.getElementById("editEmployeeCode").value);myUserAddData+="&remarks="+URLEncode(document.getElementById("editRemarks").value);var a=myServerAddress+"MyXMLDispatcher?rand="+b+"&path="+20930+"&method="+method;myUserAddRequest.open("POST",a,true);myUserAddRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");myUserAddRequest.setRequestHeader("Content-length",myUserAddData.length);myUserAddRequest.onreadystatechange=addUserAction;openSplashScreen();myUserAddRequest.send(myUserAddData)};function addUserAction(){if(myUserAddRequest.readyState==4){if(myUserAddRequest.status==200){var d=myUserAddRequest.responseXML;var a=0;if(d==null){alert("Data Error")}else{var e=d.getElementsByTagName("status");a=systemStatus(null,e)}if(a==1){var b=d.getElementsByTagName("key")[0].getAttribute("value");var c=d.getElementsByTagName("key")[0].getAttribute("type");var g=Array();var f=0;g[0]=""+b;g[1]=document.getElementById("editUserID").value;g[2]=document.getElementById("editName").value;g[3]=document.getElementById("editRemarks").value;g[4]=document.getElementById("editEmployeeCode").value;addRowToTable1(myUserTable,-1,g)}else{if(a==2){alert("ADD: System Error")}}userPropertiesWindow.close()}else{alert("Connection Problem:"+myUserAddRequest.statusText);userPropertiesWindow.close()}closeSplashScreen()}}initializeUserManagementTable(10350);var myContextUserAccesRightsWindow=function(){var a=null;var b=contextMenu.srcElement;while(true){a=b.parentNode;if(a.tagName!="TR"){b=a;continue}else{break}}if(a!=null){populateAccessEditWin(a)}};var myUserAccesRightsWindow=function(c){var d=document.getElementById(c);var a=null;for(var b=0;b<d.tBodies[0].rows.length;b++){if(d.tBodies[0].rows[b].myRow&&d.tBodies[0].rows[b].myRow.content[1].getAttribute("type")=="radio"&&d.tBodies[0].rows[b].myRow.content[1].checked){a=d.tBodies[0].rows[b]}}if(a!=null){populateAccessEditWin(a)}};var userId;var userName;var permissionManagerContainer="blankHidden2";var PERMOptionsContainer="permOptions";var PERMInnnerContainer="innerPERMContainer";var permOptionsWindow;var permOptionsWindowId="permCatOptionsWindowId";var PERMINNER_TABLE_NAME="permInnerSample";var PERMINNER_DIV_NAV_NAME="permInnerNavDiv";var populateAccessEditWin=function(c){if(document.getElementById(permissionManagerContainer)==null){return}var a="menuWindowId"+c.myRow.content[8];userId=c.myRow.content[8];var b="Permissions for: [ "+c.myRow.content[4].data+" ]";userName=c.myRow.content[4].data;var d=document.getElementById(permissionManagerContainer);d.innerHTML="<div id='"+PERMOptionsContainer+"'>"+c.myRow.content[4].data+"</div>";openMenuPermissionTable();permOptionsWindow=internalWindow.open(permOptionsWindowId,"div",permissionManagerContainer,b,"width=750px,height=400px,left=200px,top=150px,resize=1,scrolling=1")};var menuTableparent=1;var menuTableTop=1;var menuTableCurrentParent=1;var menuTablecontainer=PERMOptionsContainer;var openMenuPermissionTable=function(){callMenuAjax(1)};function callMenuAjax(d){if(document.getElementById(menuTablecontainer)==null){return}var b=getHTMLHTTPRequest();menuTableCurrentParent=d;var c=parseInt(Math.random()*99999999);var a=myServerAddress+"MyXMLDispatcher?rand="+c+"&path="+20940+"&parent="+d+"&userId="+userId+"&method=getMenuPermissions";b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200){renderMenu(b)}else{alert("Connection Problem:"+b.statusText)}}};writeWaitMsg(menuTablecontainer,"themes/icons/ajax_loading/22.gif","Loading page, please wait...");b.send(null)}function renderMenu(b){var c=b.responseXML;if(c==null){alert("Data Error");return}var d=c.getElementsByTagName("status");var a=systemStatus(menuTablecontainer,d);if(a==0){return}var e="";e+="<div id='"+PERMINNER_DIV_NAV_NAME+"'></div>";e+="<table id='"+PERMINNER_TABLE_NAME+"' width='97%' class='innerContentTable'><thead id='PERMTThead'><tr><td width='18px'>&nbsp;</td><td width='1%'>Sl</td><td width='20%'>Name</td><td width='100%'>Description<td width='16px'>&nbsp;</td><td width='16px'>&nbsp;</td></tr></thead>";e+="<tbody id='PERMTTbody'></tbody></table>";document.getElementById(menuTablecontainer).innerHTML=e;updateMenuNav(c,PERMINNER_DIV_NAV_NAME);populateMenuTable(c,PERMINNER_TABLE_NAME);addTableRolloverEffect(PERMINNER_TABLE_NAME,"tableRollOverEffect2","tableRowClickEffect2")}var updateMenuNav=function(b,a){var d=b.getElementsByTagName("levelParent");var c="<table class='innerNavTable'><tr>";if(d!=null&&d.length>=1){menuTableparent=d[0].getAttribute("id");c+="<td><a style='text-decoration: none;' href='javascript:void(0);' onclick='callMenuAjax("+menuTableparent+")'><img src='images/admin/up.png' border='0' alt='Up one level'></a></td>";c+="<td><a style='text-decoration: none;' href='javascript:void(0);' onclick='callMenuAjax("+menuTableTop+")'><img src='images/admin/top.png' border='0' alt='Top level'></a></td>"}else{c+="<td><img src='images/admin/up1.png' alt='Up one level'></td>";c+="<td><img src='images/admin/top1.png' alt='Top level'></td>";menuTableparent=1}c+="</tr></table>";document.getElementById(a).innerHTML=c};var populateMenuTable=function(e,b){var d=e.getElementsByTagName("item");for(var c=0;c<d.length;c++){var f=document.getElementById(b);var a=f.tBodies[0].rows.length;var g=Array();g[0]=d[c].childNodes[0].firstChild.data;g[1]=d[c].childNodes[1].firstChild.data;g[2]=d[c].childNodes[2].firstChild.data;g[3]=d[c].childNodes[3].firstChild.data;g[4]=d[c].childNodes[4].firstChild.data;addRowToTable10(f,-1,g)}};var addRowToTable10=function(e,f,c){var k=e.tBodies[0].rows.length;var b=k+ROW_BASE;if(f==-1){f=k}else{b=f+ROW_BASE}var l=e.tBodies[0].insertRow(f);var j=Array();j[0]=l.insertCell(0);j[0].innerHTML="<a href='javascript:void(0);' onclick='callMenuAjax("+c[0]+")'><img src='images/admin/application.png' border='0' width='16' height='16'></a>";j[1]=l.insertCell(1);var g=document.createTextNode(b);j[1].appendChild(g);j[2]=l.insertCell(2);var a=document.createTextNode(c[1]);j[2].appendChild(a);j[3]=l.insertCell(3);var i=document.createTextNode(c[2]);j[3].appendChild(i);j[4]=l.insertCell(4);if(c[3]=="1"){j[4].innerHTML="<a href='javascript:void(0);' onclick='callUpdateMenuPermissionsAjax(event)'><img src='images/admin/icon_status_green_light.gif' border='0'></a>"}else{j[4].innerHTML="<a href='javascript:void(0);'><img src='images/admin/icon_status_green.gif' border='0'></a>"}j[5]=l.insertCell(5);if(c[3]=="0"){j[5].innerHTML="<a href='javascript:void(0);' onclick='callUpdateMenuPermissionsAjax(event)'><img src='images/admin/icon_status_red_light.gif' border='0'></a>"}else{j[5].innerHTML="<a href='javascript:void(0);'><img src='images/admin/icon_status_red.gif' border='0'></a>"}var d=Array();d[0]=0;d[1]=0;d[2]=j[0].innerHTML;d[3]=g;d[4]=a;d[5]=i;d[6]=c[0];d[7]=c[4];d[8]=c[3];var h=new myRowObject(d);l.myRow=h};var callUpdateMenuPermissionsAjax=function(d){var a=d;var k;var c;if(a.target){k=a.target.parentNode.parentNode.parentNode}else{if(a.srcElement){k=a.srcElement.parentNode.parentNode.parentNode}}var g=k.sectionRowIndex;c=k.parentNode.parentNode;var f=k.myRow.content[6];var i=k.myRow.content[8]=="0"?"1":"0";var j=(i=="1"?"Block":"Grant")+" access to ["+k.myRow.content[4].data+"] for user: "+userName+"?";if(!window.confirm(j)){return}var h=getHTMLHTTPRequest();var b=parseInt(Math.random()*99999999);url=myServerAddress+"MyXMLDispatcher?rand="+b+"&path="+20950+"&userId="+userId+"&menuId="+f+"&permission="+i+"&method=updateMenuPermission";h.open("GET",url,true);h.onreadystatechange=function(){updateMenuPermissionAction(h,k)};openSplashScreen();h.send(null)};var updateMenuPermissionAction=function(b,e){if(b.readyState==4){if(b.status==200){var c=b.responseXML;var a=0;if(c==null){alert("Data Error")}else{var d=c.getElementsByTagName("status");a=systemStatus(null,d)}if(a==1){e.myRow.content[8]=(e.myRow.content[8]=="0")?"1":"0";if(e.myRow.content[8]=="1"){e.cells[4].innerHTML="<a href='javascript:void(0);' onclick='callUpdateMenuPermissionsAjax(event)'><img src='images/admin/icon_status_green_light.gif' border='0'></a>"}else{e.cells[4].innerHTML="<a href='javascript:void(0);'><img src='images/admin/icon_status_green.gif' border='0'></a>"}if(e.myRow.content[8]=="0"){e.cells[5].innerHTML="<a href='javascript:void(0);' onclick='callUpdateMenuPermissionsAjax(event)'><img src='images/admin/icon_status_red_light.gif' border='0'></a>"}else{e.cells[5].innerHTML="<a href='javascript:void(0);'><img src='images/admin/icon_status_red.gif' border='0'></a>"}}else{if(a==2){alert("UPDATE: System Error")}}}else{alert("Connection Problem:"+b.statusText)}closeSplashScreen()}};